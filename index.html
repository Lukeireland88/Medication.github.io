<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paul Ireland Medication Tracker</title>

  <!-- Favicon and app icons -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' ry='20' fill='white'/><rect x='15' y='35' width='70' height='30' rx='15' ry='15' fill='%232563eb'/><line x1='50' y1='35' x2='50' y2='65' stroke='white' stroke-width='6'/></svg>">
  <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABMklEQVRYR+2X0Q2DMBBFz1AUwAtwAFzABdwAF3ABuVgE7YgUSoiqK8E0Q0/7b2QykZlQ+f8b3ZmcwnNAhAAZgAYeMKvXwMg6yBa2IESEATrhrfABTAt9W79GMtDap4Az6D6OwPfw4kMcFkcLeBpcAyD/yQYyIGJs9jCEvTdHcm0BLeIJQFgBo7GqFtvG/IOU1SBcRkHZZJ2gDbC6gBwqFmGfRS+UUHi7pr8gTKioeMt1Dh6cfaxlZPCQbMrbMpI3AdkWRY0dQy5ak1U5tVEnZcXbZyjqTsEoFsU93tkP4+VcsAZ+0JY0aqj7yKwAWZTvNfYC4tQTpZz/vEKdM6NugQO7sPhNPXOrvVJ0r2oWg+TjyeB4cRtF2we8AAAAASUVORK5CYII=" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#2563eb">
  <!-- Manifest will be generated at runtime so this can stay a single file -->
  <script>
    (function(){
      const svgIcon = "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' ry='20' fill='white'/><rect x='15' y='35' width='70' height='30' rx='15' ry='15' fill='%232563eb'/><line x1='50' y1='35' x2='50' y2='65' stroke='white' stroke-width='6'/></svg>";
      const manifest = {
        name: "Paul Ireland Medication Tracker",
        short_name: "Meds",
        start_url: ".",
        scope: ".",
        display: "standalone",
        background_color: "#ffffff",
        theme_color: "#2563eb",
        icons: [
          { src: svgIcon, type: "image/svg+xml", sizes: "any", purpose: "any maskable" }
        ]
      };
      const blob = new Blob([JSON.stringify(manifest)], { type: "application/manifest+json" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('link');
      link.rel = 'manifest';
      link.href = url;
      document.head.appendChild(link);
    })();
  </script>

  <style>
    :root {
      --bg: #f7f7fb;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --accent: #2563eb;
      --accent-weak: #dbeafe;
      --border: #e5e7eb;
      --multi-bg: #fff7cc;
    }

    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text); background: var(--bg); display: grid; place-items: start center;
    }

    .container { width: min(900px, 96vw); padding: 24px; }

    header { display: grid; gap: 8px; margin-bottom: 16px; }
    h1 { margin: 0; font-size: clamp(22px, 3.8vw, 30px); }
    .sub { color: var(--muted); font-size: clamp(13px, 1.5vw, 14px); }

    .card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); }

    /* Collapsible time picker */
    .time-toggle { padding: 12px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-weight: 600; }
    .time-options { display: none; grid-template-columns: repeat(2, 1fr); gap: 8px; padding: 12px; border-bottom: 1px solid var(--border); }
    .time-btn {
      appearance: none; border: 1px solid var(--border); background: var(--card); color: var(--text);
      padding: 10px 12px; border-radius: 12px; font-weight: 600; cursor: pointer; text-align: center;
    }
    .time-btn[aria-pressed="true"] { border-color: var(--accent); background: var(--accent-weak); color: var(--accent); }

    /* Table */
    .table-wrap { padding: 0 12px 12px; }
    table { width: 100%; border-collapse: collapse; overflow: hidden; border-radius: 12px; }
    thead th { text-align: left; font-size: clamp(13px, 1.6vw, 14px); color: var(--muted); background: #f9fafb; border-bottom: 1px solid var(--border); padding: 12px; }
    tbody td { padding: 14px; border-bottom: 1px solid var(--border); vertical-align: middle; font-size: clamp(14px, 2.2vw, 16px); word-break: break-word; }
    tr:last-child td { border-bottom: none; }
    .taken td { color: #6b7280; text-decoration: line-through; }
    .pill { font-weight: 600; }
    .multi-row td { background: var(--multi-bg); }
    .badge { font-size: 11px; padding: 2px 6px; border-radius: 999px; border: 1px solid var(--border); margin-left: 8px; }

    /* Footer summary */
    .summary { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-top: 1px solid var(--border); color: var(--muted); font-size: clamp(12px, 1.8vw, 14px); }

    input[type="checkbox"] { width: 22px; height: 22px; accent-color: var(--accent); }

    @media (max-width: 480px) {
      .time-options { grid-template-columns: 1fr; }
      input[type="checkbox"] { width: 28px; height: 28px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Medication Tracker</h1>
      <div id="dateLine" class="sub"></div>
    </header>

    <section class="card">
      <div class="time-toggle" onclick="toggleOptions()">
        <span id="currentLabel">Showing: Morning</span>
        <span id="toggleArrow">▼</span>
      </div>
      <div class="time-options" id="timeOptions">
        <button class="time-btn" data-time="Morning" aria-pressed="true">Morning</button>
        <button class="time-btn" data-time="Lunch" aria-pressed="false">Lunch</button>
        <button class="time-btn" data-time="Evening" aria-pressed="false">Evening</button>
        <button class="time-btn" data-time="Night" aria-pressed="false">Night</button>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th scope="col">Taken</th>
              <th scope="col">Medication</th>
              <th scope="col">When</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>

      <div class="summary">
        <div><strong id="remaining"></strong> left for this time.</div>
        <div>Highlighted items show all times they are used (tray: Multiple). Checklist resets on refresh.</div>
      </div>
    </section>
  </div>

  <script>
    const MEDS = {
      Morning: [
        { name: "Indapamide", when: "Daily" },
        { name: "Isosorbide", when: "Daily" },
        { name: "Lansoprazole", when: "Daily" },
        { name: "Rivaroxaban", when: "Daily" },
        { name: "Bumetanide", when: "Daily" },
        { name: "Carbocisteine", when: "Daily" },
        { name: "Diltiazem", when: "Daily" },
        { name: "Levetiracetam (1000 mg)", when: "Daily" },
        { name: "Phenoxymethylpenicillin", when: "Daily" },
        { name: "Salbutamol Nebuliser Liquid", when: "Daily" },
        { name: "Trimbow inhaler (Red)", when: "Daily" },
        { name: "Ferrous Fumarate", when: "Every 2 days" },
        { name: "Azithromycin", when: "Monday, Wednesday, Friday" },
      ],
      Lunch: [
        { name: "Levetiracetam (500 mg)", when: "Daily" },
        { name: "Bumetanide", when: "Daily" },
        { name: "Carbocisteine", when: "Daily" },
        { name: "Salbutamol Nebuliser Liquid", when: "Daily" },
      ],
      Evening: [
        { name: "Salbutamol Nebuliser Liquid", when: "Daily" },
      ],
      Night: [
        { name: "Folic Acid", when: "Daily" },
        { name: "Atorvastatin", when: "Daily" },
        { name: "Sodium Picosulfate", when: "Daily" },
        { name: "Clopidogrel", when: "Daily" },
        { name: "Carbocisteine", when: "Daily" },
        { name: "Diltiazem", when: "Daily" },
        { name: "Levetiracetam (1000 mg)", when: "Daily" },
        { name: "Phenoxymethylpenicillin", when: "Daily" },
        { name: "Salbutamol Nebuliser Liquid", when: "Daily" },
        { name: "Trimbow inhaler (Red)", when: "Daily" },
      ],
    };

    const multiMap = (() => {
      const m = new Map();
      const norm = s => s.replace(/\(.*?\)/g, '').trim().toLowerCase();
      for (const [time, section] of Object.entries(MEDS)) {
        for (const med of section) {
          const key = norm(med.name);
          if (!m.has(key)) m.set(key, []);
          if (!m.get(key).includes(time)) m.get(key).push(time);
        }
      }
      return { map: m, norm };
    })();

    let currentTime = 'Morning';

    function formatDateLine() {
      const d = new Date();
      const weekday = d.toLocaleDateString(undefined, { weekday: 'long' });
      const date = d.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
      document.getElementById('dateLine').textContent = `${weekday} · ${date}`;
    }

    function toggleOptions() {
      const options = document.getElementById('timeOptions');
      const arrow = document.getElementById('toggleArrow');
      const isOpen = options.style.display === 'grid';
      options.style.display = isOpen ? 'none' : 'grid';
      arrow.textContent = isOpen ? '▼' : '▲';
    }

    function setTime(time) {
      currentTime = time;
      document.querySelectorAll('.time-btn').forEach(btn => btn.setAttribute('aria-pressed', String(btn.dataset.time === time)));
      document.getElementById('timeOptions').style.display = 'none';
      document.getElementById('toggleArrow').textContent = '▼';
      render();
    }

    function getDefaultTime() {
      const hour = new Date().getHours();
      if (hour < 12) return 'Morning';
      if (hour < 15) return 'Lunch';
      if (hour < 19) return 'Evening';
      return 'Night';
    }

    function render() {
      const tbody = document.getElementById('tbody');
      tbody.innerHTML = '';

      MEDS[currentTime].forEach((med) => {
        const row = document.createElement('tr');

        const checkCell = document.createElement('td');
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.addEventListener('change', () => {
          row.classList.toggle('taken', cb.checked);
          updateRemaining();
        });
        checkCell.appendChild(cb);

        const nameCell = document.createElement('td');
        nameCell.className = 'pill';
        nameCell.textContent = med.name;

        const whenCell = document.createElement('td');
        whenCell.textContent = med.when;

        const times = multiMap.map.get(multiMap.norm(med.name)) || [];
        if (times.length > 1) {
          row.classList.add('multi-row');
          const badge = document.createElement('span');
          badge.className = 'badge';
          badge.textContent = 'Multiple: ' + times.join(', ');
          nameCell.appendChild(badge);
        }

        row.appendChild(checkCell);
        row.appendChild(nameCell);
        row.appendChild(whenCell);
        tbody.appendChild(row);
      });

      updateRemaining();
      document.getElementById('currentLabel').textContent = `Showing: ${currentTime}`;
    }

    function updateRemaining() {
      const checkboxes = Array.from(document.querySelectorAll('tbody input[type="checkbox"]'));
      const remaining = checkboxes.filter(cb => !cb.checked).length;
      document.getElementById('remaining').textContent = `${remaining} item${remaining !== 1 ? 's' : ''}`;
    }

    document.querySelectorAll('.time-btn').forEach(btn => btn.addEventListener('click', () => setTime(btn.dataset.time)));

    formatDateLine();
    setTime(getDefaultTime());
  </script>
</body>
</html>
